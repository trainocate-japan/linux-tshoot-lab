(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{326:function(a,t,v){a.exports=v.p+"assets/img/linuxintro-tshoot-structure-instructor.drawio.980be144.svg"},336:function(a,t,v){"use strict";v.r(t);var _=v(27),s=Object(_.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"講師向けガイド"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#講師向けガイド"}},[a._v("#")]),a._v(" 講師向けガイド")]),a._v(" "),t("h2",{attrs:{id:"コース概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#コース概要"}},[a._v("#")]),a._v(" コース概要")]),a._v(" "),t("ul",[t("li",[a._v("Linuxで稼働しているシステムに発生するシステムトラブルの種類や対応できるコマンドの紹介や、システムトラブル対応の基礎を学ぶコースです")]),a._v(" "),t("li",[a._v("コースは2日構成です。1日目はトラブル対応に関連する知識を学ぶ座学で、2日目はトラブル解決を実践する演習を行います")]),a._v(" "),t("li",[a._v("発生するトラブルのほとんどは実務で使えるLinux 入門編」を学んでいれば解決できる内容です（速習Linuxでも構いません）\n"),t("ul",[t("li",[a._v("一部、自己で検索が必要なトラブルも含まれます")]),a._v(" "),t("li",[a._v("前提のコースで取り上げてないことは全て受講者向け資料で補足します")])])])]),a._v(" "),t("h2",{attrs:{id:"演習概要"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#演習概要"}},[a._v("#")]),a._v(" 演習概要")]),a._v(" "),t("ul",[t("li",[a._v("Red Hat系Linuxで稼動するWebシステムに発生したトラブルを解決し、システムの復旧作業を実践します")]),a._v(" "),t("li",[a._v("webアプリケーションサーバーとDBサーバーに発生した複数のトラブルを修復する作業を通じて、実際の現場でのトラブル対応に近い体験ができます")]),a._v(" "),t("li",[a._v("演習での復旧作業のまとめとして、障害報告書を作成する時間を2日目の最後にとります")])]),a._v(" "),t("h2",{attrs:{id:"構成図"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#構成図"}},[a._v("#")]),a._v(" 構成図")]),a._v(" "),t("p",[t("img",{attrs:{src:v(326),alt:"構成図"}})]),a._v(" "),t("h3",{attrs:{id:"構成図解説"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#構成図解説"}},[a._v("#")]),a._v(" 構成図解説")]),a._v(" "),t("blockquote",[t("p",[a._v("わかもれなど、環境への接続については省略しています")])]),a._v(" "),t("ul",[t("li",[a._v("1台のAWS EC2インスタンス(base-machie:Ubuntu) に、2台のホストからなるWebシステムを構成しています（構成構上の黄色箇所）")]),a._v(" "),t("li",[a._v("Webシステムの他、作業端末用にもう一台ホストがあります（構成図右側の青塗りつぶし箇所）")]),a._v(" "),t("li",[a._v("インスタンス内の各ホストはLXCコンテナで実現しています\n"),t("ul",[t("li",[a._v("EC2インスタンスはNestedVMに対応していないため、LXCコンテナを採用しました")])])]),a._v(" "),t("li",[a._v("LXCコンテナ内のOSはAlmaLinux9です。今後変更の可能性はあります")]),a._v(" "),t("li",[a._v("インスタンス内コンテナのネットワークアドレスは、受講者ごとに異なる可能性があります")]),a._v(" "),t("li",[a._v("構成図上の左側にあるNginx（ねずみ色箇所）はリバースプロキシとして稼動させています。詳細は後述します")]),a._v(" "),t("li",[a._v("受講者向け構成図は、LXCコンテナなどを省いた簡略版（演習に必要な情報のみ）を展開します。ただし、興味のある受講者向けに詳細構成図やLXCの解説などを付録として記載する予定です")])]),a._v(" "),t("h3",{attrs:{id:"構成詳細"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#構成詳細"}},[a._v("#")]),a._v(" 構成詳細")]),a._v(" "),t("ul",[t("li",[a._v("ログインのための認証情報は構成図に記載があります")])]),a._v(" "),t("h4",{attrs:{id:"base-machine"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#base-machine"}},[a._v("#")]),a._v(" Base-Machine")]),a._v(" "),t("ul",[t("li",[a._v("Ubuntu 24.02")]),a._v(" "),t("li",[a._v("演習環境のベースとなるホストです。Ubuntuを採用した意図としては、LXCが使いやすいことと、作業環境ではないことをすぐに気づけるようにするためです")]),a._v(" "),t("li",[a._v("Base-Machine上では、Nginxの復旧を除きトラブルシューティング作業は行いません")]),a._v(" "),t("li",[a._v("Ubuntuのシェルを使っていることが分かるように、シェルのプロンプトを変更しています")])]),a._v(" "),t("h4",{attrs:{id:"appコンテナ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appコンテナ"}},[a._v("#")]),a._v(" Appコンテナ")]),a._v(" "),t("ul",[t("li",[a._v("Alma Linux 9")]),a._v(" "),t("li",[a._v("Apache HTTP Server")]),a._v(" "),t("li",[a._v("Linux個人演習のWebアプリを流用")]),a._v(" "),t("li",[a._v("後述のNginxをWebサーバーとしているため、Appサーバーと名前を変えてますがあまり意味はありません")])]),a._v(" "),t("h4",{attrs:{id:"dbコンテナ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dbコンテナ"}},[a._v("#")]),a._v(" DBコンテナ")]),a._v(" "),t("ul",[t("li",[a._v("Alma Linux 9")]),a._v(" "),t("li",[a._v("MariaDB")]),a._v(" "),t("li",[a._v("Linux個人演習のWebアプリを流用")])]),a._v(" "),t("h4",{attrs:{id:"作業端末"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作業端末"}},[a._v("#")]),a._v(" 作業端末")]),a._v(" "),t("ul",[t("li",[a._v("Alma Linux 9")]),a._v(" "),t("li",[a._v("受講者はUbuntuからこちらにログインし、トラブルシュート作業を行う")])]),a._v(" "),t("h4",{attrs:{id:"nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[a._v("#")]),a._v(" nginx")]),a._v(" "),t("ul",[t("li",[a._v("Ubuntu上で直接稼働するサービス")]),a._v(" "),t("li",[a._v("Webサーバーにインスタンス外部からの接続をルーティングするために使用")]),a._v(" "),t("li",[a._v("もう一つ、netdata（負荷計測用。後述）のユーザー認証のためにも使用しています\n"),t("ul",[t("li",[a._v("インターネットにポートを開放しているため、Basic認証をかけるためです")])])])]),a._v(" "),t("h4",{attrs:{id:"netdata"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#netdata"}},[a._v("#")]),a._v(" Netdata")]),a._v(" "),t("ul",[t("li",[a._v("UbuntuやLXCコンテナの負荷計測用に、Netdataというオープンソースの監視ソフトウェアをUbuntu上で動作させています\n"),t("ul",[t("li",[a._v("Dockerを使っていますが、受講者はそれを意識する必要はありません")])])]),a._v(" "),t("li",[a._v("Netdataで情報を見るためにはBasic認証をする必要があります。認証情報は構成図に記載してあります（user1/password）")]),a._v(" "),t("li",[a._v("サーバーが高負荷状態に陥っているので修正せよ、という意図のトラブルを仕込む予定のために配置しています")])]),a._v(" "),t("h2",{attrs:{id:"発生するトラブルについて"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#発生するトラブルについて"}},[a._v("#")]),a._v(" 発生するトラブルについて")]),a._v(" "),t("h3",{attrs:{id:"appコンテナ-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appコンテナ-2"}},[a._v("#")]),a._v(" Appコンテナ")]),a._v(" "),t("h4",{attrs:{id:"apacheサービスを停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apacheサービスを停止"}},[a._v("#")]),a._v(" Apacheサービスを停止")]),a._v(" "),t("ul",[t("li",[a._v("stopするだけなので、systemctl startで復旧できます")])]),a._v(" "),t("h4",{attrs:{id:"etc-httpd-conf-httpd-confのdocumentrootがシンタックスエラー"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#etc-httpd-conf-httpd-confのdocumentrootがシンタックスエラー"}},[a._v("#")]),a._v(" /etc/httpd/conf/httpd.confのDocumentrootがシンタックスエラー")]),a._v(" "),t("ul",[t("li",[a._v("/var/log/mariadb/mariadb.logを閲覧すればシンタックスエラーが出ているので気づけるはずです")])]),a._v(" "),t("h4",{attrs:{id:"cpu負荷を異常に上昇"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cpu負荷を異常に上昇"}},[a._v("#")]),a._v(" CPU負荷を異常に上昇")]),a._v(" "),t("ul",[t("li",[a._v("stressかyesコマンドを利用します")]),a._v(" "),t("li",[a._v("作業に影響が出るほど負荷をかけられないので、障害発生前にNetdataで取得した情報と比較して気づけるようにします")])]),a._v(" "),t("h4",{attrs:{id:"systemctl-enable-されておらず、自動起動しない"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#systemctl-enable-されておらず、自動起動しない"}},[a._v("#")]),a._v(" systemctl enable されておらず、自動起動しない")]),a._v(" "),t("ul",[t("li",[a._v("復旧確認後に動作確認としてコンテナをリブートするように指示するので、そこで再び障害となります。もちろんすでに修正済みの場合は何も起きません")])]),a._v(" "),t("h3",{attrs:{id:"mariadbコンテナ"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mariadbコンテナ"}},[a._v("#")]),a._v(" MariaDBコンテナ")]),a._v(" "),t("h4",{attrs:{id:"mariadbサービスを停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mariadbサービスを停止"}},[a._v("#")]),a._v(" MariaDBサービスを停止")]),a._v(" "),t("ul",[t("li",[a._v("stopするだけなので、systemctl startで復旧できます")])]),a._v(" "),t("h4",{attrs:{id:"ip-link-set-eth0-down-を実行"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ip-link-set-eth0-down-を実行"}},[a._v("#")]),a._v(" ip link set eth0 down を実行")]),a._v(" "),t("ul",[t("li",[a._v("リンクダウン障害を起こします。これとストレージ問題を解決しないとMariaDBは起動できません")]),a._v(" "),t("li",[a._v("DBコンテナにSSHログインできなくなるため 、コンソールログイン用のLXCコマンドが必要になります。 リンクダウン障害や復旧方法も含めて、受講者向けのWeb資料にヒントとして記載します")])]),a._v(" "),t("h4",{attrs:{id:"ストレージの消費量が100-になっている"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ストレージの消費量が100-になっている"}},[a._v("#")]),a._v(" ストレージの消費量が100%になっている")]),a._v(" "),t("ul",[t("li",[a._v("ddコマンドで無駄なファイルを生成しストレージの残りが0%になっており、MariaDBのstartができなくなってます")]),a._v(" "),t("li",[a._v("/var/log/mariadb/mariadb.logを閲覧すればストレージ不足のエラーが出ているので気づけるはずです")]),a._v(" "),t("li",[a._v("無駄なファイルがどこにあるかを探すコマンドは受講者ガイドにヒントとして記載します")])]),a._v(" "),t("h3",{attrs:{id:"nginxサービスを停止"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nginxサービスを停止"}},[a._v("#")]),a._v(" Nginxサービスを停止")]),a._v(" "),t("ul",[t("li",[a._v("Appサーバーまでは復旧して内部的にwebページを参照できるがインターネットからは見れない、という状態です。復旧確認として、Ubuntuからページを見るためのcurlコマンドを受講者向けガイドには記載します\n"),t("ul",[t("li",[a._v("Ubuntu上でコマンドを発行することになりますがsystemctlだけなので実施できると想定しています")])])]),a._v(" "),t("li",[a._v("Nginxが落ちている間はブラウザアクセスができないので、Netdataへのアクセスも出来ないはずです。なので、AppコンテナのCPU高騰に気づくのはこのタイミングだと思います")])]),a._v(" "),t("h2",{attrs:{id:"講師用端末について"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#講師用端末について"}},[a._v("#")]),a._v(" 講師用端末について")]),a._v(" "),t("ul",[t("li",[a._v("トラブル発生の捜査や、受講者Weサイトの復旧を確認するための講師用端末を用意しています。演習中はログインしておいてください")]),a._v(" "),t("li",[a._v("ログイン方法は受講者同様、わかもれです")])]),a._v(" "),t("h2",{attrs:{id:"トラブルの発生方法について"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブルの発生方法について"}},[a._v("#")]),a._v(" トラブルの発生方法について")]),a._v(" "),t("ul",[t("li",[a._v("AWSの運用サービスであるSSM RunCommandを使って、インスタンスの外部から以下のシェルスクリプトを注入して実行します\n"),t("ul",[t("li",[a._v("講師用端末にスクリプトを配置するので、AWSコンソールへのログインは不要です")])])]),a._v(" "),t("li",[a._v("受講者端末のURLを監視するシェルスクリプトを配置します。watchコマンドと合わせて実行すると、どのURLが復旧しているのかがリアルタイムでわかります")]),a._v(" "),t("li",[a._v("受講者の作業が完了しているかの確認は、testinfra（Python製の構成確認ツール）を使う予定です。受講者ホストのアドレスを指定すればtestinfraが設定の自動チェックをかけるので講師が逐一チェックする必要はありません（の予定）")])]),a._v(" "),t("h2",{attrs:{id:"コースの進め方"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#コースの進め方"}},[a._v("#")]),a._v(" コースの進め方")]),a._v(" "),t("h3",{attrs:{id:"オリエンテーション"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#オリエンテーション"}},[a._v("#")]),a._v(" オリエンテーション")]),a._v(" "),t("ul",[t("li",[a._v("30-40min")]),a._v(" "),t("li",[a._v("演習の説明")]),a._v(" "),t("li",[a._v("演習環境の解説、ログイン方法\n"),t("ul",[t("li",[a._v("以前から利用しているわかもれなので皆さん覚えているはずですが、講師からのデモがあるとよいと思います")])])]),a._v(" "),t("li",[a._v("トラブル発生タイミングのお知らせ\n"),t("ul",[t("li",[a._v("11:10の全体休憩後に、講師の手によりトラブルが発生します")])])]),a._v(" "),t("li",[a._v("質疑応答")])]),a._v(" "),t("h3",{attrs:{id:"現状把握"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#現状把握"}},[a._v("#")]),a._v(" 現状把握")]),a._v(" "),t("ul",[t("li",[a._v("20-30min")]),a._v(" "),t("li",[a._v("インターネットからのアクセスを試す")]),a._v(" "),t("li",[a._v("Netdataの監視状況をメモ\n"),t("ul",[t("li",[a._v("スクリーンキャプチャでもよい")])])]),a._v(" "),t("li",[a._v("IPアドレスの記録、構成図をみながら各サーバーへのログインなどを試す")]),a._v(" "),t("li",[a._v("質疑応答\n"),t("ul",[t("li",[a._v("構成について聞かれると思います")])])])]),a._v(" "),t("h3",{attrs:{id:"トラブル発生"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブル発生"}},[a._v("#")]),a._v(" トラブル発生")]),a._v(" "),t("ul",[t("li",[a._v("11:10にスクリプトで実施してください")]),a._v(" "),t("li",[a._v("URL監視が全てダウンするはずです")])]),a._v(" "),t("h3",{attrs:{id:"トラブルシューティング"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#トラブルシューティング"}},[a._v("#")]),a._v(" トラブルシューティング")]),a._v(" "),t("ul",[t("li",[a._v("15:00過ぎまで")]),a._v(" "),t("li",[a._v("この間は、トラブル解決手法以外の質問には回答してください。トラブル解決の方法を答える必要はありません")])]),a._v(" "),t("h4",{attrs:{id:"復旧完了連絡の対応"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#復旧完了連絡の対応"}},[a._v("#")]),a._v(" 復旧完了連絡の対応")]),a._v(" "),t("ul",[t("li",[a._v("トラブルが解決したら講師に連絡することになっています。受講者から連絡があったら、以下を確認してください\n"),t("ul",[t("li",[a._v("受講者ホストのURL監視が復旧していること")]),a._v(" "),t("li",[a._v("testinfraを実行してトラブル発生箇所の修正が全て完了していること")])])]),a._v(" "),t("li",[a._v("完了した受講者には、再発防止策の策定と、障害報告書の作成を指示してください。書き方は受講者資料に記載してあります")])]),a._v(" "),t("h3",{attrs:{id:"障害報告書の提出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#障害報告書の提出"}},[a._v("#")]),a._v(" 障害報告書の提出")]),a._v(" "),t("ul",[t("li",[a._v("UMUのアンケートで提出します。これをもって演習は終了です")]),a._v(" "),t("li",[a._v("記載する内容は受講者向け資料で指示しますが、テキスト形式でのフリーフォーマットです")]),a._v(" "),t("li",[a._v("個別での評価は不要ですが、あまりに内容が薄いものやふざけているものがあれば修正を指示してください")]),a._v(" "),t("li",[a._v("書きかけで時間切れとなった場合はそこまでを提出してもらって終了です")])]),a._v(" "),t("h2",{attrs:{id:"その他"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#その他"}},[a._v("#")]),a._v(" その他")]),a._v(" "),t("ul",[t("li",[a._v("受講者ホストはリブートすると障害発生前の状態に戻ります。なのでrebootとshutdown -r nowはできないようにsudoersで制限してます")])])])}),[],!1,null,null,null);t.default=s.exports}}]);